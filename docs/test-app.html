<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>论文分析测试页面</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        .loading .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .controls {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .paper-list {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .paper-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .paper-item:last-child {
            border-bottom: none;
        }
        .paper-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .paper-authors {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .paper-conference {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }
        .paper-year {
            color: #999;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SRF 会议论文分析系统</h1>
        <p>测试数据加载和显示功能</p>
    </div>

    <div id="loading" class="loading">
        <div class="spinner"></div>
        正在加载论文数据...
    </div>

    <div id="error" style="display: none;"></div>
    <div id="success" style="display: none;"></div>

    <div id="content" style="display: none;">
        <div class="controls">
            <input type="text" id="searchInput" class="search-box" placeholder="搜索论文标题、作者或关键词...">
            <p>共找到 <span id="paperCount">0</span> 篇论文</p>
        </div>

        <div id="paperList" class="paper-list">
            <!-- 论文列表将在这里显示 -->
        </div>
    </div>

    <script>
        // 简化的论文应用类
        class SimplePaperApp {
            constructor() {
                this.papers = [];
                this.filteredPapers = [];
                this.loadingElement = document.getElementById('loading');
                this.errorElement = document.getElementById('error');
                this.successElement = document.getElementById('success');
                this.contentElement = document.getElementById('content');
                this.paperListElement = document.getElementById('paperList');
                this.paperCountElement = document.getElementById('paperCount');
                this.searchInput = document.getElementById('searchInput');
                
                this.init();
            }

            async init() {
                console.log('初始化论文应用...');
                
                // 搜索事件监听
                this.searchInput.addEventListener('input', () => {
                    this.searchPapers();
                });

                // 加载数据
                await this.loadData();
            }

            showLoading(message) {
                this.loadingElement.style.display = 'block';
                this.loadingElement.innerHTML = `<div class="spinner"></div>${message}`;
                this.errorElement.style.display = 'none';
                this.successElement.style.display = 'none';
                this.contentElement.style.display = 'none';
            }

            showError(message) {
                this.loadingElement.style.display = 'none';
                this.errorElement.style.display = 'block';
                this.errorElement.className = 'error';
                this.errorElement.textContent = `错误: ${message}`;
                this.successElement.style.display = 'none';
                this.contentElement.style.display = 'none';
            }

            showSuccess(message) {
                this.loadingElement.style.display = 'none';
                this.errorElement.style.display = 'none';
                this.successElement.style.display = 'block';
                this.successElement.className = 'success';
                this.successElement.textContent = message;
                this.contentElement.style.display = 'block';
            }

            async loadData() {
                this.showLoading('正在加载论文数据...');
                
            try {
                const possiblePaths = [
                    'data/papers-combined.json',
                    './data/papers-combined.json',
                    'data/papers-medium.json',
                    'data/papers-simple.json',
                    './data/papers-medium.json',
                    './data/papers-simple.json',
                    'data/papers.json',
                    './data/papers.json'
                ];                    let data = null;
                    let loadedPath = null;
                    
                    for (const path of possiblePaths) {
                        try {
                            console.log('尝试加载路径:', path);
                            const response = await fetch(path);
                            if (response.ok) {
                                data = await response.json();
                                loadedPath = path;
                                console.log('成功加载数据，路径:', path, '论文数量:', data.papers?.length || 0);
                                break;
                            } else {
                                console.log('HTTP错误:', response.status, response.statusText);
                            }
                        } catch (error) {
                            console.log('路径失败:', path, error.message);
                        }
                    }
                    
                    if (data && data.papers) {
                        this.papers = data.papers;
                        this.filteredPapers = [...this.papers];
                        this.showSuccess(`成功加载 ${this.papers.length} 篇论文 (来源: ${loadedPath})`);
                        this.renderPapers();
                        this.updateCount();
                    } else {
                        throw new Error('所有路径都失败了，没有找到有效数据');
                    }
                } catch (error) {
                    console.warn('无法加载真实数据，使用模拟数据:', error);
                    this.papers = this.generateMockData();
                    this.filteredPapers = [...this.papers];
                    this.showSuccess(`使用模拟数据，共 ${this.papers.length} 篇论文`);
                    this.renderPapers();
                    this.updateCount();
                }
            }

            generateMockData() {
                return [
                    {
                        title: "超导射频腔体设计优化研究",
                        authors: ["张三", "李四"],
                        conference: "IPAC2025",
                        year: 2025,
                        abstract: "本文研究了超导射频腔体的设计优化方法..."
                    },
                    {
                        title: "高功率RF系统性能分析",
                        authors: ["王五"],
                        conference: "IPAC2025", 
                        year: 2025,
                        abstract: "分析了高功率RF系统的性能特征..."
                    },
                    {
                        title: "直线加速器束流动力学研究",
                        authors: ["赵六", "孙七"],
                        conference: "HIAT2025",
                        year: 2025,
                        abstract: "研究了直线加速器中的束流动力学问题..."
                    }
                ];
            }

            searchPapers() {
                const query = this.searchInput.value.toLowerCase().trim();
                
                if (!query) {
                    this.filteredPapers = [...this.papers];
                } else {
                    this.filteredPapers = this.papers.filter(paper => {
                        return (
                            paper.title.toLowerCase().includes(query) ||
                            paper.authors.some(author => author.toLowerCase().includes(query)) ||
                            (paper.abstract && paper.abstract.toLowerCase().includes(query))
                        );
                    });
                }
                
                this.renderPapers();
                this.updateCount();
            }

            renderPapers() {
                if (this.filteredPapers.length === 0) {
                    this.paperListElement.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">没有找到匹配的论文</div>';
                    return;
                }

                const html = this.filteredPapers.map(paper => `
                    <div class="paper-item">
                        <div class="paper-title">${paper.title}</div>
                        <div class="paper-authors">作者: ${paper.authors.join(', ')}</div>
                        <div style="margin-top: 8px;">
                            <span class="paper-conference">${paper.conference}</span>
                            <span class="paper-year">${paper.year}</span>
                        </div>
                    </div>
                `).join('');

                this.paperListElement.innerHTML = html;
            }

            updateCount() {
                this.paperCountElement.textContent = this.filteredPapers.length;
            }
        }

        // 页面加载完成后立即初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，初始化应用...');
            window.app = new SimplePaperApp();
        });
    </script>
</body>
</html>
